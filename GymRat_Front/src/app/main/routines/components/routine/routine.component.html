<form class="h-full" (ngSubmit)="this.saveRoutine()">
  <section
    class="m-auto w-3/4 flex flex-col"
    *ngIf="this.routine; else createNewRoutine"
  >
    <div class="relative flex">
      <div class="w-full flex justify-between">
        <div class="flex items-center">
          <h1 class="text-xl">Routine {{ this.routineNumber + 1 }}</h1>
          <img
            #shareRef
            class="ml-4 w-6 h-6 cursor-pointer"
            src="assets/share-icon.png"
            alt="share icon"
            title="Share Routine"
            (click)="this.changeShareRoutine()"
          />
          <img
            class="ml-4 w-6 h-6 cursor-pointer"
            src="assets/pencil-icon.png"
            (click)="this.onEditRoutineClick()"
          />
        </div>
        <img
          class="w-8 h-8 cursor-pointer"
          src="assets/trash-icon.png"
          alt="trash-icon"
          title="Remove Routine"
          (click)="this.onRemoveRoutineClick(routine)"
        />
      </div>
      <shared-dropdown
        dropdownClassNames="md:w-1/5 sm:w-2/4 h-44 left-0"
        [isOpen]="this.isShareRoutineOpen"
        [openComponentRef]="this.shareIconRef"
        (onClickOutise)="this.onCloseDropdown()"
        (onEscape)="this.onCloseDropdown()"
      >
        <li
          class="flex items-center justify-around p-2"
          *ngFor="let friend of this.friendsToShare"
        >
          <p>{{ friend.username }}</p>
          <img
            class="h-8 w-8 ml-2 cursor-pointer"
            src="assets/share-icon.png"
            (click)="this.onShareRoutineClick(friend.username)"
          />
        </li>
      </shared-dropdown>
    </div>

    <div class="grid md:grid-cols-2 sm:grid-cols-1">
      <shared-input
        class="p-4"
        label="Muscular Group"
        [inputValue]="this.routine.muscularGroup"
        [editable]="false"
      />
      <shared-input
        class="p-4"
        inputType="date"
        label="Realization Date"
        [inputValue]="this.routine.realizationDate | date : 'yyyy-MM-dd'"
        [editable]="false"
      />
    </div>

    <img
      [class]="
        'w-10 h-10 m-4 self-center cursor-pointer hover:scale-125 transition-all duration-500 ease-out delay-150 ' +
        (this.showExercises ? 'rotate-180' : '')
      "
      src="assets/dropdown.png"
      (click)="this.changeShowExercises()"
    />
    <div [@fadeInFromTop] [@fadeOutToTop] *ngIf="this.showExercises">
      <div
        class="w-full h-16 flex items-center justify-center"
        *ngIf="this.editingRoutine"
      >
        <div class="w-24 h-full">
          <shared-button
            buttonType="button"
            (onButtonClick)="this.addExercise()"
            >Add Exercise
          </shared-button>
        </div>
      </div>
      <routines-superset
        *ngFor="let exercise of this.exercises; index as i"
        [exerciseNumber]="i + 1"
        [exercises]="exercise.exercises"
        [isSuperset]="exercise.exercises.length > 1"
        [hideItems]="true"
        [editing]="this.editingRoutine"
        (creationEvent)="this.addComponent($event)"
        (trash)="this.deleteComponent($event)"
      />
      <ng-template #supersetRef class="mb-4"></ng-template>
      <div class="h-14 w-24 m-auto" *ngIf="this.editingRoutine">
        <shared-button class="mt-24" buttonType="submit">
          Update
        </shared-button>
      </div>
      <p class="w-full mt-4 text-center text-red-700" *ngIf="this.isError">
        There are missing fields
      </p>
    </div>
  </section>

  <ng-template #createNewRoutine>
    <section class="h-full flex flex-col justify-around p-2">
      <div
        class="exercise-bar-shadow w-full h-16 flex items-center justify-center"
      >
        <div class="w-24 h-full">
          <shared-button
            buttonType="button"
            (onButtonClick)="this.addExercise()"
            >Add Exercise
          </shared-button>
        </div>
      </div>

      <div class="h-full p-4 mt-6 grid grid-cols-1 scrollable-div pb-10">
        <ng-template #supersetRef class="mb-4"></ng-template>

        <div
          *ngIf="this.componentReferences.length > 0"
          class="h-14 w-24 m-auto"
        >
          <shared-button class="mt-24" buttonType="submit">
            Create
          </shared-button>
        </div>
      </div>
      <p class="w-full mt-4 text-center text-red-700" *ngIf="this.isError">
        There are missing fields
      </p>
    </section>
  </ng-template>
</form>
